schema: 1
story: 'EPIC-greenfield-multi-cluster-gitops.STORY-NET-CILIUM-CORE-GITOPS'
story_title: 'STORY-NET-CILIUM-CORE-GITOPS — Create Cilium GitOps Manifests'
gate: 'PASS'
status_reason: 'All manifest ACs satisfied locally; flux dry‑run and kubeconform passed. Deployment/OCI preflight deferred to Story 45/CI and does not block manifest readiness.'
reviewer: 'Quinn (Test Architect)'
updated: '2025-10-27T00:00:00Z'
waiver: { active: false }

top_issues: []

risk_summary:
  totals:
    critical: 0
    high: 3
    medium: 4
    low: 3
  highest:
    id: TECH-002
    score: 6
    title: "Flux postBuild substitution misconfigured or not applied"
  recommendations:
    must_fix:
      - "Add/verify postBuild.substituteFrom to reference ConfigMap/cluster-settings in both clusters"
      - "Wire cilium/core Kustomization in infra/apps with healthChecks"
      - "Add CI preflight: verify OCI mirror or use official Cilium OCI for 1.18.3"
    monitor:
      - "Optional CI: helm template chart render to detect value key drift"
      - "Periodic diff: bootstrap values vs HelmRelease"

test_design:
  scenarios_total: 18
  by_level:
    unit: 0
    integration: 18
    e2e: 0
  by_priority:
    p0: 3
    p1: 15
    p2: 0
  coverage_gaps: []

quality_score: 95
evidence:
  tests_reviewed: 0
  risks_identified: 3
  trace:
    ac_covered: [1, 2, 3, 4, 5, 6, 8]
    ac_gaps: [7]

nfr_validation:
  security: { status: PASS, notes: 'WireGuard encryption configured; kube‑proxy replacement aligns with Cilium best practices.' }
  performance: { status: PASS, notes: 'Native routing, ServiceMonitor enabled; no heavy templates.' }
  reliability: { status: PASS, notes: 'Health checks defined; retries/CRD CreateReplace set.' }
  maintainability: { status: PASS, notes: 'Pinned versions; cluster substitution pattern clear.' }

recommendations:
  immediate:
    - action: 'Add CI job to verify OCI chart availability for 1.18.3 or fall back registry.'
      refs: ['kubernetes/infrastructure/networking/cilium/ocirepository.yaml']
    - action: 'Add repo-level ignore for flux build to skip non‑Kubernetes YAML.'
      refs: ['scripts/validate-cilium-core.sh']
  future:
    - action: 'Optional: helm template render check in CI to detect values drift vs bootstrap.'
      refs: ['bootstrap/helmfile.d/01-core.yaml.gotmpl']
