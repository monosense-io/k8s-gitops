---
version: '3'

tasks:
  clustermesh:infra:
    desc: Create/update 1Password item for infra cilium-clustermesh secret [VAULT=required]
    cmds:
      - ./scripts/generate-clustermesh-1password-item.sh -c infra -v {{.VAULT}} -t "kubernetes/infra/cilium-clustermesh"
    requires:
      vars: [VAULT]
    preconditions:
      - which kubectl jq op

  clustermesh:apps:
    desc: Create/update 1Password item for apps cilium-clustermesh secret [VAULT=required]
    cmds:
      - ./scripts/generate-clustermesh-1password-item.sh -c apps -v {{.VAULT}} -t "kubernetes/apps/cilium-clustermesh"
    requires:
      vars: [VAULT]
    preconditions:
      - which kubectl jq op

  clustermesh:all:
    desc: Create/update 1Password items for both clusters [VAULT=required]
    cmds:
      - task op:clustermesh:infra VAULT={{.VAULT}}
      - task op:clustermesh:apps  VAULT={{.VAULT}}
    requires:
      vars: [VAULT]
