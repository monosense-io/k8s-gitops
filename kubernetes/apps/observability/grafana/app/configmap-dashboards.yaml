---
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-cluster-overview
  namespace: observability
  labels:
    grafana_dashboard: "1"
data:
  cluster-overview.json: |-
    {
      "dashboard": {
        "title": "Kubernetes Cluster Overview",
        "tags": ["kubernetes", "victoria-metrics"],
        "timezone": "browser",
        "panels": [
          {
            "title": "Cluster CPU Usage",
            "targets": [
              {
                "expr": "sum(rate(container_cpu_usage_seconds_total{container!=\"\"}[5m])) by (node)",
                "legendFormat": "{{node}}"
              }
            ],
            "type": "timeseries"
          },
          {
            "title": "Cluster Memory Usage",
            "targets": [
              {
                "expr": "sum(container_memory_working_set_bytes{container!=\"\"}) by (node) / sum(machine_memory_bytes) by (node) * 100",
                "legendFormat": "{{node}}"
              }
            ],
            "type": "timeseries"
          },
          {
            "title": "Pod Count by Namespace",
            "targets": [
              {
                "expr": "sum(kube_pod_info) by (namespace)",
                "legendFormat": "{{namespace}}"
              }
            ],
            "type": "timeseries"
          },
          {
            "title": "Network I/O",
            "targets": [
              {
                "expr": "sum(rate(container_network_receive_bytes_total[5m])) by (node)",
                "legendFormat": "{{node}} RX"
              },
              {
                "expr": "sum(rate(container_network_transmit_bytes_total[5m])) by (node)",
                "legendFormat": "{{node}} TX"
              }
            ],
            "type": "timeseries"
          }
        ],
        "time": {
          "from": "now-6h",
          "to": "now"
        },
        "refresh": "30s"
      }
    }
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-victoria-metrics
  namespace: observability
  labels:
    grafana_dashboard: "1"
data:
  victoria-metrics.json: |-
    {
      "dashboard": {
        "title": "Victoria Metrics Performance",
        "tags": ["victoria-metrics", "monitoring"],
        "timezone": "browser",
        "panels": [
          {
            "title": "Active Time Series",
            "targets": [
              {
                "expr": "vm_cache_entries{type=\"storage/tsid\"}",
                "legendFormat": "Active Series"
              }
            ],
            "type": "stat"
          },
          {
            "title": "Ingestion Rate",
            "targets": [
              {
                "expr": "rate(vm_rows_inserted_total[5m])",
                "legendFormat": "Samples/sec"
              }
            ],
            "type": "timeseries"
          },
          {
            "title": "Query Rate",
            "targets": [
              {
                "expr": "rate(vm_http_requests_total{path=~\"/api/v1/query.*\"}[5m])",
                "legendFormat": "{{path}}"
              }
            ],
            "type": "timeseries"
          },
          {
            "title": "Storage Size",
            "targets": [
              {
                "expr": "vm_data_size_bytes{type!=\"indexdb\"}",
                "legendFormat": "{{type}}"
              }
            ],
            "type": "timeseries"
          },
          {
            "title": "Memory Usage",
            "targets": [
              {
                "expr": "process_resident_memory_bytes{job=\"vmsingle\"}",
                "legendFormat": "VMSingle Memory"
              }
            ],
            "type": "timeseries"
          },
          {
            "title": "Query Duration P99",
            "targets": [
              {
                "expr": "histogram_quantile(0.99, sum(rate(vm_request_duration_seconds_bucket{job=\"vmsingle\"}[5m])) by (le))",
                "legendFormat": "P99"
              }
            ],
            "type": "timeseries"
          }
        ],
        "time": {
          "from": "now-6h",
          "to": "now"
        },
        "refresh": "30s"
      }
    }
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-victoria-logs
  namespace: observability
  labels:
    grafana_dashboard: "1"
data:
  victoria-logs.json: |-
    {
      "dashboard": {
        "title": "Victoria Logs Performance",
        "tags": ["victoria-logs", "logging"],
        "timezone": "browser",
        "panels": [
          {
            "title": "Log Ingestion Rate",
            "targets": [
              {
                "expr": "rate(vl_rows_ingested_total[5m])",
                "legendFormat": "Logs/sec"
              }
            ],
            "type": "timeseries"
          },
          {
            "title": "Storage Size",
            "targets": [
              {
                "expr": "vl_data_size_bytes",
                "legendFormat": "Storage"
              }
            ],
            "type": "timeseries"
          },
          {
            "title": "Query Duration P99",
            "targets": [
              {
                "expr": "histogram_quantile(0.99, sum(rate(vl_http_request_duration_seconds_bucket[5m])) by (le))",
                "legendFormat": "P99"
              }
            ],
            "type": "timeseries"
          },
          {
            "title": "Active Streams",
            "targets": [
              {
                "expr": "vl_active_streams",
                "legendFormat": "Streams"
              }
            ],
            "type": "stat"
          }
        ],
        "time": {
          "from": "now-6h",
          "to": "now"
        },
        "refresh": "30s"
      }
    }
