---
# yaml-language-server: $schema=https://json.schemastore.org/kustomization
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
# Note: repositories is handled separately by flux-repositories Kustomization
# Note: storage is cluster-specific (deployed by infra only, via cluster infrastructure.yaml)
# Note: Cilium core is deployed via bootstrap Helmfile; day-2 features are deployed here via ks.yaml
resources:
  # - networking  # Day 2 - Cilium/CoreDNS/Spegel already deployed via Helmfile
  - security  # ClusterSecretStore (external-secrets only, RBAC/cert-manager disabled)
  # - storage  # Cluster-specific via cluster-level Kustomization (no local ks.yaml)
  # - databases  # Day 2 - CloudNativePG
  # Cilium core managed by GitOps (after one-time imperative bootstrap); day-2 features below
  - networking/cilium/core/ks.yaml         # Cilium core HelmRelease under GitOps control
  # Cilium day-2 features:
  - networking/cilium/ks.yaml               # Cilium day-2 kustomization (depends on cilium from bootstrap)
  - networking/cilium/clustermesh/ks.yaml   # Manage clustermesh secret via ExternalSecrets
  - networking/cilium/bgp/ks.yaml           # Own BGP peering policy via Flux
  - networking/cilium/gateway/ks.yaml       # Cilium Gateway API (using Cilium's native implementation)
  # Flux GitOps: Bootstrapped via Helmfile; not self-managed in this repo
