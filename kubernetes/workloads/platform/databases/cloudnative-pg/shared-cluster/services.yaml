---
# Service for Primary (Read-Write)
apiVersion: v1
kind: Service
metadata:
  name: shared-postgres-rw
  namespace: cnpg-system
  annotations:
    service.cilium.io/global: "true"
  labels:
    app.kubernetes.io/name: shared-postgres
    app.kubernetes.io/component: database
    cnpg.io/cluster: shared-postgres
    cnpg.io/role: primary
spec:
  type: ClusterIP
  selector:
    cnpg.io/cluster: shared-postgres
    cnpg.io/instanceRole: primary
  ports:
    - name: postgres
      port: 5432
      targetPort: 5432
      protocol: TCP
  sessionAffinity: None
---
# Service for Read-Only Replicas
apiVersion: v1
kind: Service
metadata:
  name: shared-postgres-ro
  namespace: cnpg-system
  annotations:
    service.cilium.io/global: "true"
  labels:
    app.kubernetes.io/name: shared-postgres
    app.kubernetes.io/component: database
    cnpg.io/cluster: shared-postgres
    cnpg.io/role: replica
spec:
  type: ClusterIP
  selector:
    cnpg.io/cluster: shared-postgres
    cnpg.io/instanceRole: replica
  ports:
    - name: postgres
      port: 5432
      targetPort: 5432
      protocol: TCP
  sessionAffinity: None
---
# Service for All Instances (Any)
apiVersion: v1
kind: Service
metadata:
  name: shared-postgres-r
  namespace: cnpg-system
  annotations:
    service.cilium.io/global: "true"
  labels:
    app.kubernetes.io/name: shared-postgres
    app.kubernetes.io/component: database
    cnpg.io/cluster: shared-postgres
spec:
  type: ClusterIP
  selector:
    cnpg.io/cluster: shared-postgres
  ports:
    - name: postgres
      port: 5432
      targetPort: 5432
      protocol: TCP
  sessionAffinity: None
