apiVersion: v1
kind: ConfigMap
metadata:
  name: cluster-settings
  namespace: flux-system
  labels:
    app.kubernetes.io/managed-by: flux
    cluster: apps
data:
  # Cluster Identity
  CLUSTER: apps
  CLUSTER_ID: "2"

  # Network Configuration
  POD_CIDR: '["10.246.0.0/16"]'
  POD_CIDR_STRING: "10.246.0.0/16"
  SERVICE_CIDR: '["10.247.0.0/16"]'
  K8S_SERVICE_HOST: "apps-k8s.monosense.io"
  K8S_SERVICE_PORT: "6443"

  # Cilium Configuration
  CILIUM_VERSION: "1.18.3"
  CLUSTERMESH_IP: "10.25.11.120"
  CILIUM_CLUSTERMESH_FQDN: "clustermesh-apps.monosense.io"
  CILIUM_CLUSTERMESH_INFRA_FQDN: "clustermesh-infra.monosense.io"
  CILIUM_GATEWAY_LB_IP: "10.25.11.121"
  CILIUM_GATEWAY_EXTERNAL_NAME: "cilium-gateway-external"
  CILIUM_GATEWAY_INTERNAL_NAME: "cilium-gateway-internal"
  CILIUM_GATEWAY_LB_IP_EXTERNAL: "10.25.11.121"
  CILIUM_GATEWAY_LB_IP_INTERNAL: "10.25.11.122"
  CILIUM_BGP_LOCAL_ASN: "64513"
  CILIUM_BGP_PEER_ASN: "64501"
  CILIUM_BGP_PEER_ADDRESS: "10.25.11.1"

  # IPAM Pool Control
  INFRA_POOL_DISABLED: "true"
  APPS_POOL_DISABLED: "false"
  CILIUM_LB_POOL_START: "10.25.11.120"
  CILIUM_LB_POOL_END: "10.25.11.139"

  # CoreDNS Configuration
  COREDNS_CLUSTER_IP: "10.247.0.10"
  COREDNS_REPLICAS: "2"

  # External Secrets Configuration
  EXTERNAL_SECRET_STORE: "onepassword"
  ONEPASSWORD_CONNECT_HOST: "http://opconnect.monosense.dev"
  ONEPASSWORD_CONNECT_TOKEN_SECRET: "onepassword-connect-token"
  ONEPASSWORD_VAULT_NAME: "Infra"  # Shared vault for both infra and apps cluster secrets
  CILIUM_CLUSTERMESH_SECRET_PATH: "kubernetes/apps/cilium-clustermesh"
  CERTMANAGER_CLOUDFLARE_SECRET_PATH: "kubernetes/apps/cert-manager/cloudflare"

  # Domain Configuration
  SECRET_DOMAIN: "monosense.io"
  LETSENCRYPT_EMAIL: "admin@monosense.io"

  # ExternalDNS Configuration
  EXTERNALDNS_INTERVAL: "1m"
  EXTERNALDNS_LOG_LEVEL: "info"
  EXTERNALDNS_TXT_PREFIX: "k8s."

  # Cloudflared Configuration
  CLOUDFLARED_REPLICAS: "2"
  CLOUDFLARED_TARGET_SERVICE: "https://cilium-gateway-external.kube-system.svc.cluster.local"

  # Rook-Ceph Configuration (apps cluster)
  ROOK_CEPH_NAMESPACE: "rook-ceph"
  ROOK_CEPH_CLUSTER_NAME: "rook-ceph"
  ROOK_CEPH_BLOCKPOOL_NAME: "rook-ceph-block"
  ROOK_CEPH_IMAGE_TAG: v19.2.3
  ROOK_CEPH_OSD_DEVICE_CLASS: "ssd"
  ROOK_CEPH_MON_COUNT: "3"

  # Storage Classes
  BLOCK_SC: "rook-ceph-block"  # Generic Rook-Ceph block storage (RBD)
  OPENEBS_LOCAL_SC: "openebs-local-nvme"  # Local NVMe storage

  # OpenEBS Configuration
  OPENEBS_BASEPATH: "/var/mnt/openebs"

  # Observability Configuration
  OBSERVABILITY_METRICS_RETENTION: "30d"
  OBSERVABILITY_LOGS_RETENTION: "30d"
  OBSERVABILITY_LOG_ENDPOINT_HOST: "victorialogs-vmauth.observability.svc.cluster.local"
  OBSERVABILITY_LOG_ENDPOINT_PORT: "9428"
  OBSERVABILITY_LOG_ENDPOINT_PATH: "/insert"
  OBSERVABILITY_LOG_ENDPOINT_TLS: "Off"
  OBSERVABILITY_LOG_TENANT: "apps"
  OBSERVABILITY_GRAFANA_SECRET_PATH: "kubernetes/apps/grafana-admin"

  # Argo CD OIDC Secret Path (1Password Connect)
  ARGOCD_OIDC_SECRET_PATH: "kubernetes/apps/argocd/oidc"

  # Dragonfly Configuration (apps)
  # Clients only; no operator on apps. Kept for potential future per-tenant instances.
  DRAGONFLY_STORAGE_CLASS: "openebs-local-nvme"
  DRAGONFLY_DATA_SIZE: "10Gi"
  DRAGONFLY_AUTH_SECRET_PATH: "kubernetes/apps/dragonfly/auth"

  # GitLab Configuration
  GITLAB_DB_SECRET_PATH: "kubernetes/apps/gitlab/db"
  GITLAB_REDIS_SECRET_PATH: "kubernetes/apps/gitlab/redis"
  GITLAB_S3_SECRET_PATH: "kubernetes/apps/gitlab/s3"
  GITLAB_ROOT_SECRET_PATH: "kubernetes/apps/gitlab/root"

  # VictoriaMetrics Configuration (Quay.io Registry)
  VICTORIAMETRICS_IMAGE_REGISTRY: "quay.io/victoriametrics"
  VICTORIAMETRICS_VERSION: "v1.122.1"
  VICTORIAMETRICS_K8S_STACK_VERSION: "0.61.11"
  GLOBAL_VM_INSERT_ENDPOINT: "http://vminsert-victoria-metrics-global-vmcluster.observability.svc.infra.cluster.local:8480"
